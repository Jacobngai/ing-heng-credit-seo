---
/**
 * Blog Post Page - English
 * Displays individual blog posts from content collections
 */

import { getCollection } from 'astro:content';
import BaseLayout from '../../../layouts/BaseLayout.astro';
import Breadcrumbs from '../../../components/Breadcrumbs.astro';
import { COMPANY_INFO } from '../../../utils/constants';

export async function getStaticPaths() {
  const allPosts = await getCollection('blogs');
  return allPosts
    .filter(post => post.data.locale === 'en')
    .map(post => ({
      params: { slug: post.slug.split('/').pop() },
      props: { post },
    }));
}

const { post } = Astro.props;
const { Content } = await post.render();

const lang = 'en';
const title = post.data.title;
const description = post.data.description;
const publishDate = typeof post.data.publishDate === 'string'
  ? post.data.publishDate
  : post.data.publishDate.toISOString();
const category = post.data.category || 'equipment-financing-tips';
const author = post.data.author || 'Ing Heng Credit';
const readTime = post.data.readingTime || 5;

// Schema markup
const schema = {
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": title,
  "description": description,
  "image": post.data.ogImage || `/images/blog/${post.slug}.jpg`,
  "datePublished": publishDate,
  "dateModified": publishDate,
  "author": {
    "@type": "Organization",
    "name": "Ing Heng Credit"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Ing Heng Credit",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.inghengcredit.com/logo.png"
    }
  }
};
---

<BaseLayout title={title} description={description} lang={lang} schema={schema}>
  <script slot="schema" type="application/ld+json" set:html={JSON.stringify(schema)} />

  <!-- Breadcrumbs -->
  <section class="bg-gray-50 border-b border-gray-200">
    <div class="container-custom">
      <Breadcrumbs
        items={[
          { label: 'Home', href: `/${lang}/` },
          { label: 'Blog', href: `/${lang}/blog` },
          { label: title, href: `/${lang}/blog/${post.slug.split('/').pop()}` }
        ]}
      />
    </div>
  </section>

  <!-- Blog Post Content -->
  <article class="section bg-white">
    <div class="container-custom">
      <div class="max-w-4xl mx-auto">
        <!-- Post Header -->
        <header class="mb-8">
          <div class="flex items-center gap-4 text-sm text-gray-600 mb-4">
            <span class="bg-[#F5F1EB] text-[#8B6F47] px-3 py-1 rounded-full font-semibold">
              {category.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}
            </span>
            <span>•</span>
            <time datetime={publishDate}>
              {new Date(publishDate).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
            </time>
            <span>•</span>
            <span>{readTime} min read</span>
          </div>

          <h1 class="text-4xl md:text-5xl font-black text-[#2D1810] mb-6 leading-tight">
            {title}
          </h1>

          {post.data.ogImage && (
            <div class="mb-8">
              <img
                src={post.data.ogImage}
                alt={title}
                class="w-full h-auto rounded-lg border-3 border-[#2D1810] shadow-brutal-lg"
                loading="lazy"
              />
            </div>
          )}

          {description && (
            <p class="text-xl text-gray-700 leading-relaxed">
              {description}
            </p>
          )}
        </header>

        <!-- Post Content -->
        <div class="prose prose-lg max-w-none blog-content">
          <Content />
        </div>

        <!-- Post Footer -->
        <footer class="mt-12 pt-8 border-t-3 border-[#2D1810]">
          <div class="flex items-center justify-between flex-wrap gap-4">
            <div>
              <span class="text-sm text-gray-600">Written by</span>
              <span class="font-bold text-[#2D1810] ml-2">{author}</span>
            </div>
            <div class="flex gap-4">
              <a
                href={`/${lang}/blog`}
                class="text-[#8B6F47] font-bold hover:underline"
              >
                ← Back to Blog
              </a>
            </div>
          </div>
        </footer>
      </div>
    </div>
  </article>

  <!-- CTA Section -->
  <section class="section bg-[#F5F1EB]">
    <div class="container-custom">
      <div class="max-w-4xl mx-auto text-center">
        <h2 class="text-3xl md:text-4xl font-black text-[#2D1810] mb-6">
          Need Equipment Financing?
        </h2>
        <p class="text-lg text-gray-700 mb-8">
          Get fast approval with Malaysia's trusted equipment financing partner since 1985.
        </p>
        <a
          href={COMPANY_INFO.whatsapp.link}
          class="inline-block bg-[#8B6F47] text-white font-black uppercase tracking-tight text-xl px-12 py-5 border-3 border-[#2D1810] shadow-[6px_6px_0_#2D1810] hover:shadow-[4px_4px_0_#2D1810] hover:translate-x-[2px] hover:translate-y-[2px] transition-all"
        >
          Get Free Quote
        </a>
      </div>
    </div>
  </section>
</BaseLayout>

<style>
  .prose {
    @apply text-gray-700 leading-relaxed;
  }

  .prose h1 {
    @apply text-3xl font-black text-[#2D1810] mt-12 mb-6;
  }

  .prose h2 {
    @apply text-2xl font-bold text-[#2D1810] mt-10 mb-4;
  }

  .prose h3 {
    @apply text-xl font-bold text-[#2D1810] mt-8 mb-3;
  }

  .prose p {
    @apply mb-4;
  }

  .prose a {
    @apply text-[#8B6F47] font-bold hover:underline;
  }

  .prose ul, .prose ol {
    @apply mb-4 ml-6;
  }

  .prose li {
    @apply mb-2;
  }

  .prose blockquote {
    @apply border-l-4 border-[#8B6F47] pl-4 italic text-gray-600 my-6;
  }

  .prose code {
    @apply bg-gray-100 px-2 py-1 rounded text-sm;
  }

  .prose pre {
    @apply bg-gray-900 text-white p-4 rounded-lg overflow-x-auto my-6;
  }

  .prose img {
    @apply my-6 rounded-lg border-3 border-[#2D1810];
  }

  .prose table {
    @apply w-full border-collapse my-6;
  }

  .prose th, .prose td {
    @apply border-2 border-[#2D1810] px-4 py-2;
  }

  .prose th {
    @apply bg-[#F5F1EB] font-bold;
  }
</style>
