---
/**
 * Blog Dropdown Component
 * Mega-menu style dropdown for blog category navigation
 * Shows all blog categories with icons, descriptions, and badges
 */

import type { Locale } from '../utils/i18n';
import { t } from '../utils/i18n';
import { BLOG_NAV_ITEMS } from '../utils/constants';

interface Props {
  lang: Locale;
  currentPath: string;
}

const { lang, currentPath } = Astro.props;

// Check if blog section is active
const isBlogActive = currentPath.includes('/blog');
---

<div class="blog-dropdown-wrapper">
  <!-- Desktop Dropdown Trigger -->
  <button
    type="button"
    class={`blog-dropdown-trigger nav-link ${isBlogActive ? 'nav-link-active' : ''}`}
    aria-expanded="false"
    aria-haspopup="true"
    aria-label="Blog navigation menu"
  >
    {t('nav.blog', lang)}
    <svg
      class="w-4 h-4 ml-1 transition-transform duration-200 dropdown-arrow"
      fill="none"
      stroke="currentColor"
      viewBox="0 0 24 24"
      aria-hidden="true"
    >
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
    </svg>
  </button>

  <!-- Dropdown Menu -->
  <div class="blog-dropdown-menu">
    <div class="blog-dropdown-content">
      <div class="blog-grid">
        {BLOG_NAV_ITEMS.map((item) => {
          const href = item.href === '/blog' ? `/${lang}/blog` : `/${lang}${item.href}`;
          const isActive = currentPath.includes(item.href) && item.href !== '/blog';

          return (
            <a
              href={href}
              class={`blog-dropdown-item ${isActive ? 'active' : ''}`}
            >
              <div class="blog-item-content">
                <div class="blog-item-header">
                  <span class="blog-icon">{item.icon}</span>
                  <span class="blog-name">{t(item.label, lang)}</span>
                  {item.badge && (
                    <span class={`blog-badge badge-${item.badge}`}>
                      {t(`equipment.${item.badge}`, lang)}
                    </span>
                  )}
                </div>
                <p class="blog-description">
                  {t(item.description, lang)}
                </p>
              </div>
              <svg
                class="blog-arrow"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                aria-hidden="true"
              >
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
            </a>
          );
        })}
      </div>

      <!-- Call-to-Action Footer -->
      <div class="blog-dropdown-footer">
        <p class="footer-text">Expert insights on equipment financing & business growth</p>
        <a
          href={`/${lang}/blog`}
          class="footer-cta"
        >
          View All Articles â†’
        </a>
      </div>
    </div>
  </div>
</div>

<style>
  .blog-dropdown-wrapper {
    position: relative;
  }

  .blog-dropdown-trigger {
    display: flex;
    align-items: center;
    cursor: pointer;
    background: none;
    border: none;
    padding: 0;
    font: inherit;
  }

  .blog-dropdown-trigger:hover .dropdown-arrow {
    transform: translateY(2px);
  }

  .blog-dropdown-trigger[aria-expanded="true"] .dropdown-arrow {
    transform: rotate(180deg);
  }

  /* Dropdown Menu */
  .blog-dropdown-menu {
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    padding-top: 0.75rem; /* Creates invisible bridge for mouse movement */
    margin-top: 0;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.2s ease, visibility 0.2s ease;
    pointer-events: none;
    z-index: 50;
    width: max-content;
    min-width: 600px;
    max-width: 800px;
  }

  .blog-dropdown-wrapper:hover .blog-dropdown-menu,
  .blog-dropdown-trigger[aria-expanded="true"] + .blog-dropdown-menu {
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
  }

  /* Keep dropdown open when hovering over the gap */
  .blog-dropdown-wrapper::before {
    content: '';
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    height: 0.75rem; /* Bridge area */
    background: transparent;
    pointer-events: auto;
  }

  .blog-dropdown-content {
    background: white;
    border-radius: 0.75rem;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    border: 1px solid #e5e7eb;
    overflow: hidden;
  }

  /* Blog Grid */
  .blog-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.5rem;
    padding: 1rem;
  }

  .blog-dropdown-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem;
    border-radius: 0.5rem;
    text-decoration: none;
    transition: all 0.2s ease;
    border: 1px solid transparent;
  }

  .blog-dropdown-item:hover {
    background: #F5F1E8;
    border-color: #DC143C;
    transform: translateX(4px);
  }

  .blog-dropdown-item.active {
    background: #E8DFD0;
    border-color: #DC143C;
  }

  .blog-item-content {
    flex: 1;
  }

  .blog-item-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.25rem;
    flex-wrap: wrap;
  }

  .blog-icon {
    font-size: 1.25rem;
    flex-shrink: 0;
  }

  .blog-name {
    font-weight: 600;
    color: #1e293b;
    font-size: 0.9375rem;
  }

  .blog-badge {
    font-size: 0.6875rem;
    padding: 0.125rem 0.5rem;
    border-radius: 9999px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.025em;
  }

  .badge-popular {
    background: #fde047;
    color: #92400e;
  }

  .blog-description {
    font-size: 0.8125rem;
    color: #64748b;
    margin: 0;
    line-height: 1.4;
  }

  .blog-arrow {
    width: 1.25rem;
    height: 1.25rem;
    color: #94a3b8;
    flex-shrink: 0;
    transition: all 0.2s ease;
  }

  .blog-dropdown-item:hover .blog-arrow {
    color: #DC143C;
    transform: translateX(4px);
  }

  /* Footer */
  .blog-dropdown-footer {
    background: #F5F1E8;
    padding: 1rem 1.5rem;
    border-top: 1px solid #E8DFD0;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .footer-text {
    font-size: 0.875rem;
    color: #2D2D2D;
    margin: 0;
  }

  .footer-cta {
    font-size: 0.875rem;
    font-weight: 600;
    color: #DC143C;
    text-decoration: none;
    transition: color 0.2s ease;
  }

  .footer-cta:hover {
    color: #B01030;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .blog-grid {
      grid-template-columns: 1fr;
    }

    .blog-dropdown-menu {
      min-width: 320px;
      max-width: 90vw;
    }
  }
</style>

<script>
  // Handle dropdown toggle
  document.addEventListener('DOMContentLoaded', () => {
    const trigger = document.querySelector('.blog-dropdown-trigger');
    const menu = document.querySelector('.blog-dropdown-menu');
    const wrapper = document.querySelector('.blog-dropdown-wrapper');

    if (trigger && menu && wrapper) {
      // Toggle on click
      trigger.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        const isExpanded = trigger.getAttribute('aria-expanded') === 'true';
        trigger.setAttribute('aria-expanded', (!isExpanded).toString());
      });

      // Close on outside click
      document.addEventListener('click', (e) => {
        if (!wrapper.contains(e.target as Node)) {
          trigger.setAttribute('aria-expanded', 'false');
        }
      });

      // Close on escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && trigger.getAttribute('aria-expanded') === 'true') {
          trigger.setAttribute('aria-expanded', 'false');
          trigger.focus();
        }
      });

      // Keep open on hover (desktop)
      wrapper.addEventListener('mouseenter', () => {
        if (window.innerWidth >= 1024) {
          trigger.setAttribute('aria-expanded', 'true');
        }
      });

      wrapper.addEventListener('mouseleave', () => {
        if (window.innerWidth >= 1024) {
          trigger.setAttribute('aria-expanded', 'false');
        }
      });
    }
  });
</script>
